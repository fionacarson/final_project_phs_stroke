---
title: "PHS Stroke Data Analysis Project"
output:
  html_document:
    toc: yes
    toc_float: true
    toc_depth: '2'
    highlight: tango
    df_print: paged
---

## Assumptions made during cleaning

For activity data the diagnosis column "Cerebrovascular disease" covers everything and is essentially the "All" category. There were originally 3 sub-categories but these didn't add up to the total value under "Cerebrovascular disease". This is because there are some other diagnosis (with ICD codes I62, I65, I66-69) which fall outwith these sub-categories. For this reason a 4th sub-category was created called "Other CVD". 

For the mortality data, "TIAs and related syndromes" are included in the "Cerebrovascular disease" category and not separated out. 

There were a lot of missing values for Orkney, Shetland and Western Isles due to confidentiality. These were converted to zeros. EXPLAIN WHY

## Assumptions made during analysis

To determine which diagnosis is most the number of diagnosis and number of deaths values were used, rather than the crude rates or easr. It was felt it was more important to know the actual number than a number adjusted for 100,000 of population (crude rate) or age adjusted (easr).


```{r}
library(tidyverse)
library(here)
```

```{r}
source(here("theme_palette_etc/plot_theme.R"))
source(here("theme_palette_etc/palette.R"))
```

```{r}
activity_hb <- read_csv(here("clean_data/activity_hb.csv"))

mortality_hb <- read_csv(here("clean_data/mortality_hb.csv"))
```

### What is the most common stroke diagnosis in Scotland?

There are two datasets which need analysed to answer this questions - the activity dataset which details the number of discharges and the mortality which details the number of deaths. It should be noted that one patient could have more than one discharge.

The unadultered values are used for this analysis as we are looking for the most common stroke diagnosis.

```{r}
activity_hb %>% 
  filter(!financial_year %in% c("2009/10", "2010/11", "2011/12")) %>% 
  filter(hbr == "S92000003" &
          age == "All" &
          sex == "All" &
          admission_type == "All" &
          diagnosis != "Cerebrovascular Disease") %>% 
  group_by(diagnosis) %>% 
  summarise(mean_num_discharges = mean(number_of_discharges)) %>% 
  mutate(diagnosis = fct_reorder(diagnosis, mean_num_discharges)) %>% 
  ggplot(aes(diagnosis, mean_num_discharges)) +
  geom_col(fill = c("#446e9b", "#999999", "#3cb521", "#e83e8c")) +
  theme_fc() +
  labs(title = "Discharges by Cerebrovascular Disease Diagnosis",
       subtitle = "10 year average", 
       y = "Annual Number of Discharges",
       x = "CVD Diagnosis") +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) 
```

Stroke is by far the most common diagnosis for patients who are discharged. 



```{r}
mortality_hb %>% 
  filter(year >= 2012) %>% 
  filter(hbr == "S92000003" &
          age == "All" &
          sex == "All" &
          diagnosis != "Cerebrovascular Disease") %>% 
  group_by(diagnosis) %>% 
  summarise(mean_num_deaths = mean(number_of_deaths)) %>% 
  mutate(diagnosis = fct_reorder(diagnosis, mean_num_deaths)) %>% 
  ggplot(aes(diagnosis, mean_num_deaths)) +
  geom_col(fill = c("#446e9b", "#999999", "#3cb521")) +
  theme_fc() +
  labs(title = "Cerebrovascular Disease Mortality",
       subtitle = "10 year average", 
       y = "Annual Number of Deaths",
       x = "CVD Diagnosis") +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) 
```



For the patients that die, stroke is also the most common diagnosis but now the "Other CVD" category is much higher than for patients that are discharged. 

It is not easy to compare the death and discharge figures as they cover different time periods. Discharges are financial year and deaths are calendar year. 

Incidence data was sources from excel files related to the PHS Stroke report but these only subcategorised cerebrovascular disease and stroke.

## Are there differences in diagnoses between different demographics?

### Age
